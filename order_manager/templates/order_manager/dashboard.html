<!-- templates/order_manager/dashboard.html -->
{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<h1>Order Management Dashboard</h1>

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

<div class="dashboard-container">
    <!-- 準備中のオーダー -->
    <div class="orders-section preparing">
        <h2>Orders in Preparation</h2>
        <div class="orders-list">
            {% for order in orders %}
                {% if order.status == 'pending' or order.status == 'processing' %}
                <div class="order-card">
                    <h3>Order #{{ order.order_number }}</h3>
                    <p class="status">Status: {{ order.get_status_display }}</p>
                    <p>Order Time: {{ order.created_at|date:"Y/m/d H:i" }}</p>
                    <p class="price">Total: ¥{{ order.total_price|floatformat:0 }}</p>
                    
                    <form method="post" action="{% url 'order_manager:update_order' order.id %}">
                        {% csrf_token %}
                        <select name="status">
                            {% for status, label in order.STATUS_CHOICES %}
                            <option value="{{ status }}" {% if status == order.status %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit">Update</button>
                    </form>
                    
                    <h4>Order Details</h4>
                    <ul>
                        {% for item in order.items.all %}
                        <li>{{ item.item_name }} x {{ item.quantity }} (¥{{ item.price|floatformat:0 }})</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            {% endfor %}
            
            {% if orders|length == 0 or not any_preparing_orders %}
            <p>No orders currently in preparation.</p>
            {% endif %}
        </div>
    </div>

    <!-- 呼び出し中のオーダー -->
    <div class="orders-section ready">
        <h2>Orders Ready for Pickup</h2>
        <div class="orders-list">
            {% for order in orders %}
                {% if order.status == 'ready' %}
                <div class="order-card">
                    <h3>Order #{{ order.order_number }}</h3>
                    <p class="status status-ready">Status: {{ order.get_status_display }}</p>
                    <p>Order Time: {{ order.created_at|date:"Y/m/d H:i" }}</p>
                    <p class="price">Total: ¥{{ order.total_price|floatformat:0 }}</p>
                    
                    <form method="post" action="{% url 'order_manager:update_order' order.id %}">
                        {% csrf_token %}
                        <select name="status">
                            {% for status, label in order.STATUS_CHOICES %}
                            <option value="{{ status }}" {% if status == order.status %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit">Update</button>
                    </form>
                    
                    <h4>Order Details</h4>
                    <ul>
                        {% for item in order.items.all %}
                        <li>{{ item.item_name }} x {{ item.quantity }} (¥{{ item.price|floatformat:0 }})</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            {% endfor %}
            
            {% if orders|length == 0 or not any_ready_orders %}
            <p>No orders currently ready for pickup.</p>
            {% endif %}
        </div>
    </div>
</div>

<style>
.dashboard-container {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

.orders-section {
    flex: 1;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.preparing {
    background-color: #f8f9fa;
}

.ready {
    background-color: #e9f7ef;
}

.order-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.status {
    font-weight: bold;
}

.status-ready {
    color: #28a745;
}

h2 {
    border-bottom: 2px solid #ddd;
    padding-bottom: 8px;
    margin-bottom: 15px;
}

.price {
    font-size: 1.1em;
    font-weight: bold;
}

form {
    margin: 10px 0;
    display: flex;
    gap: 10px;
}

button {
    padding: 5px 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background: #0069d9;
}

@media (max-width: 768px) {
    .dashboard-container {
        flex-direction: column;
    }
}
</style>

{% endblock %}